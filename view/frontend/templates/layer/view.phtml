<?

// @codingStandardsIgnoreFile

?>
<?
/**
 *
 * @var $block \GoMage\Navigation\Block\Navigation
 */
$helperData = $this->helper('GoMage\Navigation\Helper\Data');
?>

<? if ($block->canShowBlock()): ?>
    <div class="block filter block-gan-filter <?=$block->escapeHtml($block->getContainerClass());?>" data-role="navigation" data-mage-init='{"navigation": {
                        "addFilterResultsToUrl": "<?= $block->escapeHtml($block->getDataHelper()->isAddFilterResultsToUrl())?>",
                        "navigationPlace": "<?= $block->escapeHtml($block->getDataHelper()->getShowShopByIn()); ?>",
                        "categoriesPlace": "<?= $block->escapeHtml($block->getCategoryDataHelper()->getCategoriesBlockLocation()); ?>",
                        "backToTopSpeed": "<?= $block->escapeHtml($block->getDataHelper()->getBackToTopSpeed()); ?>",
                        "backToTopAction": "<?= $block->escapeHtml($block->getDataHelper()->getBackToTopAction()); ?>",
                        "tooltipOpenOnClick": "<?= $block->escapeHtml($block->getNavigationViewHelper()->isNavigationViewTooltipShowOnClick()); ?>",
                        "tooltipOpenOnMouseOver": "<?= $block->escapeHtml($block->getNavigationViewHelper()->isNavigationViewTooltipShowOnMouseOver()); ?>",
                        "tooltipCloseButton": "<?= $block->escapeHtml($block->getNavigationViewHelper()->isNavigationViewTooltipHideOnCloseButton()); ?>",
                        "tooltipCloseOnMouseOut": "<?= $block->escapeHtml($block->getNavigationViewHelper()->isNavigationViewTooltipHideOnMouseOut()); ?>",
                        "is_use_friendly": "<?= $block->getDataHelper()->isUseFriendlyUrls() ?>",
                        "ajaxAutoload": "<?= $block->escapeHtml($block->getDataHelper()->isUseAutoScrolling()); ?>"
                        }}' style="background-color: <?=$block->getNavigationViewHelper()->getNavigationViewBlockBackgroundColor()?>; ">
        <div class="block-title"><strong><?= __('Shop By') ?></strong></div>
        <div class="block-content filter-content">
            <?if ($block->getDataHelper()->isShowAppliedValuesInResults()):?>
                <?= $block->getStateBlock()->toHtml() ?>
                <? if ($block->getLayer()->getState()->getFilters()): ?>
                    <div class="block-actions filter-actions">
                        <a href="<?= $block->escapeUrl($block->getClearUrl()) ?>"
                           class="action clear filter-clear"
                           data-role="navigation-filter"
                           data-ajax="1"
                           data-clear="1">
                            <span><?= __('Clear All') ?></span>
                        </a>
                    </div>
                <? endif; ?>
            <? endif;?>
            <? $wrapOptions = false; ?>
                <? foreach ($block->getFilters() as $filter): ?>
            <?php $countApplied = 0; ?>
                    <?php $blockRender = $block->getRenderBlock(); ?>
                    <?php if ($blockRender->renderInCurrentCategory($filter)) : ?>
                        <? if (!$wrapOptions): ?>
                            <strong role="heading" aria-level="2" class="block-subtitle filter-subtitle"><?= __('Shopping Options') ?></strong>
                            <dl class="filter-options"
                                id="narrow-by-list"
                                data-role="content"
                                data-mage-init='{"accordion":{
                                "openedState": "active",
                                "collapsible": true,
                                "active": <?= json_encode($block->getExpandedFilters());?>,
                                "multipleCollapsible": true
                                }}'>

                            <? $wrapOptions = true; endif; ?>

                            <? if ($filter->getItemsCount()): ?>
                                <?php foreach ($filter->getItems() as $item): ?>
                                    <?php $helperData->checkIsActive($item, $filter->getRequestVar()) ?>
                                    <?php if($item->isShowAppliedValues()): ?>
                                        <?php $countApplied ++;  ?>
                                    <?php endif; ?>
                                <?php endforeach; ?>
                                <?php if($countApplied): ?>
                                    <div data-role="collapsible" class="filter-options-item <?= $block->escapeHtml($block->getItemClass()) ?>"
                                         style="<?= $block->escapeHtml($block->getItemWidthStyle()) ?>">
                                        <dt  data-collapsed-param = "<?php echo strtolower($filter->getName()); ?>" data-collapsed-filter ="<?php echo ((int)!$filter->getGomageIsCollapsed()) ?>" data-role="title" role="heading" style="overflow: inherit" aria-level="3" class="filter-options-title collapsed-apply-settings">
                                            <?= $block->escapeHtml(__($filter->getName())) ?>
                                            <?php
                                                $tooltip = $this->getLayout()->createBlock('GoMage\Navigation\Block\Navigation\Tooltip');
                                                $tooltip->assign('filter', $filter);
                                                echo $tooltip->toHtml();
                                            ?>
                                        </dt>
                                        <dd data-role="content" class="filter-options-content"><?= $blockRender->render($filter); ?></dd>
                                    </div>
                               <?php endif; ?>
                            <? endif; ?>
                    <?php endif; ?>
                <? endforeach; ?>
                <? if ($wrapOptions): ?>
                    </dl>
                <? endif; ?>

        </div>
    </div>
<? endif; ?>
